name: Update LeetCode Progress

on:
  schedule:
    - cron: "0 8 * * *"  # Runs every day at 8 AM UTC
  workflow_dispatch:  # Allows manual trigger

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v3
        with:
          python-version: '3.x'

      - name: Install Dependencies
        run: pip install requests

      - name: Fetch LeetCode Progress and Update README
        run: |
          python <<EOF
          import requests
          import datetime

          LEETCODE_USERNAME = "raziord2717"  # Change to your LeetCode username

          def fetch_solved_problems():
              url = f"https://leetcode-stats-api.herokuapp.com/{LEETCODE_USERNAME}"
              response = requests.get(url)
              
              if response.status_code != 200:
                  print(f"❌ Failed to fetch LeetCode data. HTTP Status Code: {response.status_code}")
                  exit(1)

              return response.json()

          # Fetch LeetCode stats
          leetcode_data = fetch_solved_problems()
          last_updated = datetime.datetime.utcnow().strftime("%Y-%m-%d %H:%M:%S UTC")

          # Read the existing README template
          with open("README.md", "r") as file:
              readme_template = file.read()

          # Replace placeholders with real values
          readme_content = readme_template.replace("{{total_solved}}", str(leetcode_data["totalSolved"]))
          readme_content = readme_content.replace("{{total_questions}}", str(leetcode_data["totalQuestions"]))
          readme_content = readme_content.replace("{{easy_solved}}", str(leetcode_data["easySolved"]))
          readme_content = readme_content.replace("{{total_easy}}", str(leetcode_data["totalEasy"]))
          readme_content = readme_content.replace("{{medium_solved}}", str(leetcode_data["mediumSolved"]))
          readme_content = readme_content.replace("{{total_medium}}", str(leetcode_data["totalMedium"]))
          readme_content = readme_content.replace("{{hard_solved}}", str(leetcode_data["hardSolved"]))
          readme_content = readme_content.replace("{{total_hard}}", str(leetcode_data["totalHard"]))
          readme_content = readme_content.replace("{{last_updated}}", last_updated)

          # Write the new content back to README.md
          with open("README.md", "w") as file:
              file.write(readme_content)
          EOF

      - name: Commit and Push Changes
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add README.md
          git diff --quiet && git diff --staged --quiet || git commit -m "🔄 Automated update of LeetCode progress"
          git push https://x-access-token:${GITHUB_TOKEN}@github.com/Charanbyreddy/Leetcode-Progress.git main
