name: Update LeetCode Progress

on:
  schedule:
    - cron: "0 8 * * *"  # Runs every day at 8 AM UTC
  workflow_dispatch:  # Allows manual trigger

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v3
        with:
          python-version: '3.x'

      - name: Install Dependencies
        run: pip install requests

      - name: Fetch LeetCode Progress and Update README
        run: |
          python <<EOF
          import requests

          LEETCODE_USERNAME = "raziord2717"  # 🔹 Update with your username

          def fetch_solved_problems():
              url = f"https://leetcode-stats-api.herokuapp.com/{LEETCODE_USERNAME}"
              response = requests.get(url)
              
              if response.status_code != 200:
                  print(f"❌ Failed to fetch LeetCode data. HTTP Status Code: {response.status_code}")
                  exit(1)

              data = response.json()
              return data

          # Fetch LeetCode stats
          leetcode_data = fetch_solved_problems()

          # Update README.md file
          with open("README.md", "w") as f:
              f.write("# 🚀 LeetCode Progress\n\n")
              f.write(f"✅ **Total Problems Solved:** {leetcode_data['totalSolved']} / {leetcode_data['totalQuestions']}\n\n")
              f.write(f"🏆 **Easy:** {leetcode_data['easySolved']} / {leetcode_data['totalEasy']}\n")
              f.write(f"🔥 **Medium:** {leetcode_data['mediumSolved']} / {leetcode_data['totalMedium']}\n")
              f.write(f"💀 **Hard:** {leetcode_data['hardSolved']} / {leetcode_data['totalHard']}\n")

          EOF

      - name: Commit and Push Changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add README.md
          git diff --quiet && git diff --staged --quiet || git commit -m "🔄 Automated update of LeetCode progress"
          git push origin main
